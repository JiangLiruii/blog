---
layout:       post
title:        "HTTP(hypertext transfer protocol 超文本传输)"
subtitle:     "无线通信"
date:         2018-12-15 12:00:00
author:       "Lorry"
header-mask:  0.3
header-img:   '/img/Fast-Moving-Light-Wallpaper.jpg'
catalog:      true
multilingual: false
tags:
    - web
---

## History

### HTTP 0.9: 单条语句

Tim Berners-Lee 设计了HTTP, 是最初的www的萌芽阶段

- 客户端请求一个单独的ASCII码字符串
- 客户端请求以CRLF结尾
- 服务器响应一个ASCII码流
- 服务端响应一个HTML
- 传输完成后连接终止

比如现在还支持的telnet命令, GET方法进行请求, 没有请求头或其他元数据, 只有HTML, 这是简单得不能再简单的东西.

`$> telnet google.com 80`

HTTP 0.9的特性:
- 客户端服务端, 请求响应的协议
- ASCII协议, 运行在TCP/IP之上
- 通过HTML进行传输
- 每次请求之后关闭连接

### HTTP/1.0 快速增长

91-95年HTML也发展得很快, 出现了一个叫 "网页浏览器" 的软件, 面向消费者的公用网络基础的需求急剧增长

在 Tim Berner-lee的服务器原型之上, 一家名为National Center of Supercomputing Application(NCSA)的团队做出了第一个受欢迎的浏览器 NCSA Mosaic, 在1994年成立了Mosaic Communication 公司, 最后被更名为网景(Netscape), 在1994年12月发展出了网景导航1.0版本

HTTP/1.0的请求长这样:
```
$> telnet website.org 80

Connected to xxx.xxx.xxx.xxx

GET /rfc/rfc1945.txt HTTP/1.0  --*1
User-Agent: CERN-LineMode/2.15 libwww/2.17b3
Accept: */*

HTTP/1.0 200 OK   --*2
Content-Type: text/plain
Content-Length: 137582
Expires: Thu, 01 Dec 1997 16:00:00 GMT
Last-Modified: Wed, 1 May 1996 12:45:26 GMT
Server: Apache 0.84

(plain-text response)
(connection closed)

*1 HTTP版本的请求行, 紧跟着是请求头
*2 相应状态, 紧跟着响应头
```
跟HTTP 0.9相比有如下改变:
- 请求可以有多个独立头字段的新行组成
- 响应对象会有一个相应状态行
- 响应对象有自己的一套独立头字段的新行
- 不仅仅限于hypertext超文本
- 连接在每个请求之后关闭

> 每个请求都需要一个新的TCP连接导致了性能上的瓶颈, **三次握手的慢启动**

## HTTP/1.1 互联网标准

第一个HTTP/1.1标准在1997年发布, 大概就在1.0版本后的6个月时间. 两个半年后, 1999年, 1.1的一些改进和升级被发布

HTTP/1.1 有如下优化
- keepalive
- chuanked encoding transfers
- byte-range 请求
- 更多的caching机制
- 传输编码
- 请求管道化

```
$> telnet website.org 80
Connected to xxx.xxx.xxx.xxx

GET /index.html HTTP/1.1        ---*1
Host: website.org
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_4)... (snip)
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Encoding: gzip,deflate,sdch
Accept-Language: en-US,en;q=0.8
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3
Cookie: __qca=P0-800083390... (snip)

HTTP/1.1 200 OK         ---*2
Server: nginx/1.0.11
Connection: keep-alive
Content-Type: text/html; charset=utf-8
Via: HTTP/1.1 GWA
Date: Wed, 25 Jul 2012 20:23:35 GMT
Expires: Wed, 25 Jul 2012 20:23:35 GMT
Cache-Control: max-age=0, no-cache
Transfer-Encoding: chunked

100             ---*3
<!doctype html>
(snip)

100
(snip)

0           ---*4

GET /favicon.ico HTTP/1.1       ---*5
Host: www.website.org
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_4)... (snip)
Accept: */*
Referer: http://website.org/
Connection: close           ---*6
Accept-Encoding: gzip,deflate,sdch
Accept-Language: en-US,en;q=0.8
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3
Cookie: __qca=P0-800083390... (snip)

HTTP/1.1 200 OK             ---*7
Server: nginx/1.0.11
Content-Type: image/x-icon
Content-Length: 3638
Connection: close
Last-Modified: Thu, 19 Jul 2012 17:51:44 GMT
Cache-Control: max-age=315360000
Accept-Ranges: bytes
Via: HTTP/1.1 GWA
Date: Sat, 21 Jul 2012 21:35:22 GMT
Expires: Thu, 31 Dec 2037 23:55:55 GMT
Etag: W/PSA-GAu26oXbDi

(icon data)
(connection closed)

*1 请求HTML文件, 需要编码格式, 字符集, cookie元数据
*2 原始HTML请求的块(chunked)响应
*3 以ASCII十六进制表示chunk的字节数(256位)
*4 chunk流的结束响应
*5 在同一个TCP连接中请求icon
*6 通知服务器连接不会再被重用
*7 icon响应, 接着关闭连接
```

> HTTP/1.1中的keepalive为默认开启, 如果不想使用需 `Connection: close`的请求头, 在HTTP/1.0中需要使用`Connection: Keep-Alive`

## HTTP/2: 改善传输性能

随着业务的增长, 用户和web开发真越来越需要接近实时的响应传输和更高协议性能要求, 在HTTP/1.1上修修补补已经不能满足要求了, 所以在2012年有了HTTP/2, HTTP/2有更低的延迟和更高的吞吐量, 但是并没有改变高级协议的语法: 所有的请求头, 值, 使用场景都一样.

任何已有的应用都可以不做任何改变的在HTTP/2中传输. 只是服务器会通过HTTP/2进行响应.

虽然最终的HTTP/2协议标准已经完成, 但是依然需要在可预期的未来兼容HTTP/1.1, 大概还要10年左右吧.